{% extends 'base.html.twig' %}
{% block style %}
    {{ parent() }}
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
          integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
          crossorigin=""/>

    <style>
        #mapid{
            min-height: 550px;
        }
    </style>
{% endblock %}

{% block body %}
    <section class="container mt-5">
        <div class="row">

            <aside class="col-lg-6">
                <div id="mapid" class="map-container z-depth-1-half"></div>
                <p class="text-muted">Cliquez sur la map pour avoir votre <strong>longitude</strong> et votre <strong>latitude</strong>.</p>
            </aside >

            <aside class="col-lg-6 mt-5 mt-lg-0">
                <form>
                    <h2 class="mb-4 text-sm-center text-lg-left">Observation</h2>

                    <div class="form-group">
                        <label for="defaultFormContactSpiecie" class="grey-text">Espèce</label>
                        <input type="text" id="defaultFormContactSpiecie" class="form-control">
                    </div>

                    <div class="form-group">
                        <label for="defaultFormContactMessageEx" class="grey-text">Description de votre observation</label>
                        <textarea id="defaultFormContactMessageEx" class="form-control" rows="3"></textarea>
                    </div>

                    <hr>

                    <div class="row">
                        <div class="form-group col-6">
                            <label for="lat" class="grey-text">Latitude</label>
                            <input type="text" id="lat" class="form-control">
                        </div>

                        <div class="form-group col-6">
                            <label for="long" class="grey-text">longitude</label>
                            <input type="text" id="long" class="form-control">
                        </div>

                        <div class="form-group col-12">
                            <button class="btn btn-outline-info col-12" id="localisation" >
                                Appuyer pour être localisé par GPS<i class="fa fa-map-marker ml-2"></i>
                            </button>
                        </div>
                    </div>

                    <hr>

                    <div class="form-group text-right">
                        <button class="col-6 btn btn-success" type="submit">Envoyer<i class="fa fa-paper-plane-o ml-2"></i></button>
                    </div>

                </form>
                <!-- Default form contact -->
            </aside>
        </div>
    </section>

{% endblock %}

{% block script %}
    {{ parent() }}
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
            integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
            crossorigin="">
    </script>
    <!-- JQuery -->
    <script
            src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
            crossorigin="anonymous"></script>
    <!-- JQuery-ui -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.js"></script>
    <!-- Leaflet JS var -->
    <script>
        $(document).ready(function(){
            // initialisation de la map + position de la map
            let mymap = L.map('mapid').setView([47, 1.9], 6);
            L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                maxZoom: 8,
                id: 'mapbox.streets',
                accessToken: 'pk.eyJ1IjoiZnJvc3RlIiwiYSI6ImNqaDd3OHdtbzAwbm0ycXFsbmFtOTJidTIifQ.C6l9gAch8EEE5fxzCIF35g'
            }).addTo(mymap);

            let marker;
            // fonction click sur la map pour donner la position du clic et remplit lat et long dans form
            function onMapClick(e) {
                if (typeof (marker)==='undefined') {
                    marker = new L.marker(e.latlng);
                    marker.addTo(mymap)
                        .bindPopup("Votre latitude et votre longitude a été renseigné en fonction de l'endroit ou vous venez de cliquer (" + e.latlng + ")").openPopup();
                }else {
                    marker.setLatLng(e.latlng)
                        .bindPopup("Votre latitude et votre longitude a été renseigné en fonction de l'endroit ou vous venez de cliquer (" + e.latlng + ")").openPopup();
                }
                $("#form_latitude").val(e.latlng.lat); // a remplacer par l'id du champ latitude
                $("#form_longitude").val(e.latlng.lng); // a remplacer par l'id du champ longitude
            }

            // si localisation OK donne lat et long avec marker et remplit lat et long dans form
            function onLactionFound(e){
                L.marker(e.latlng).addTo(mymap)
                    .bindPopup("Votre latitude et votre longitude a été renseigné en fonction de votre emplacement GPS (" + e.latlng + ")").openPopup();

                $("#form_latitude").val(e.latlng.lat); // a remplacer par l'id du champ latitude
                $("#form_longitude").val(e.latlng.lng); // a remplacer par l'id du champ longitude
            }

            // Message d'erreur de l'ocalisation
            function onLocationError(e) {
                alert(e.message);
            }

            // service de localisation
            $("#localisation").click(function(){
                mymap.locate({setView: true, maxZoom: 16});
            });

            mymap.on('click', onMapClick);
            mymap.on('locationfound', onLactionFound);
            mymap.on('locationerror', onLocationError);
        });
    </script>

    <script>
        // $(document).ready(function() {
        //     var species = [
                {#{% for specie in species %}#}
                {#"{{ specie.nomFr }}",#}
                {#{% endfor %}#}
            // ];

            // $('#form_species').autocomplete({
            //     source: species,
            //     minLength: 2
            // });
        // });
    </script>
{% endblock %}
